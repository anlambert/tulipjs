<!DOCTYPE html>
<html>

    <head>
     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=yes">
     <title>Tulip Web demo</title>
     <link rel="icon" type="image/x-icon" href="favicon.ico" />
     <link rel="stylesheet" href="http://css-spinners.com/css/spinner/whirly.css" type="text/css">
     <link rel="stylesheet" href="https://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
     <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
     <script type="text/javascript" src="https://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>

     <style type="text/css">
         .ui-icon-interactor-navigation,
         .ui-icon-interactor-zoom,
         .ui-icon-interactor-selection,
         .ui-icon-interactor-selection-modifier,
         .ui-icon-interactor-lasso-selection,
         .ui-icon-interactor-neighborhood
         {
              background-color: transparent;
              box-shadow: none;
              -moz-border-radius: 0px;
              -webkit-border-radius:0px;
              border-radius:0px;
         }
        .ui-icon-interactor-navigation {
             background-image: url("images/i_navigation.png");
         }
        .ui-icon-interactor-zoom {
             background-image: url("images/i_zoom.png");
        }
        .ui-icon-interactor-selection {
             background-image: url("images/i_selection.png");
        }
        .ui-icon-interactor-selection-modifier {
             background-image: url("images/i_move.png");
        }
        .ui-icon-interactor-lasso-selection {
             background-image: url("images/i_lasso.png");
        }
        .ui-icon-interactor-neighborhood {
             background-image: url("images/i_neighborhood_highlighter.png");
        }
        .ui-focus,
        .ui-btn:focus {
            -moz-box-shadow: none;
            -webkit-box-shadow: none;
            box-shadow: none ;
        }

        #tulip-view {
          display: table-cell;
          text-align: center;
          vertical-align: middle;
          height:100%;
        }

      </style>

    </head>

    <body>
    <!-- page #one -->
    <div data-role="page" id="one" align="center" class="ui-responsive-panel" >
    <!-- header -->
      <div data-role="header">
        <!-- <h1>Tulip Web</h> -->
        <a href="#computepanel" class="ui-btn-left">Menu</a>
        <div data-role="controlgroup" data-type="horizontal" style="display: inline-block;">

        <a id="navigation-button" href=# class="ui-icon-nodisc ui-btn-active interactor-button" data-role="button" data-icon="interactor-navigation" data-iconpos="notext">Navigate in graph</a>
        <a id="zoom-button" href=# class="ui-icon-nodisc interactor-button" data-role="button" data-icon="interactor-zoom" data-iconpos="notext">Zoom on rectangle</a>
        <a id="selection-button" href=# class="ui-icon-nodisc interactor-button" data-role="button" data-icon="interactor-selection" data-iconpos="notext">Select nodes/edges in a rectangle</a>
        <a id="lasso-selection-button" href=# class="ui-icon-nodisc interactor-button" data-role="button" data-icon="interactor-lasso-selection" data-iconpos="notext">Select nodes in a freehand drawn region</a>
        <a id="neighborhood-highlighter-button" href=# class="ui-icon-nodisc interactor-button" data-role="button" data-icon="interactor-neighborhood" data-iconpos="notext">Highlight node neighborhood</a>
        <a id="selection-modifier-button" href=# class="ui-icon-nodisc interactor-button" data-role="button" data-icon="interactor-selection-modifier" data-iconpos="notext">Move rectangle selection</a>

        </div>

        <a href="#renderingparamspanel" class="ui-btn-right">Rendering parameters</a>

      </div>
      <!-- content -->
      <div id ="main-content" data-role="content" data-theme="a" style='min-height:60px'>
        <div id="tulip-view">
          <div id='spinner-div'>
            <div class="whirly-loader"></div>
            <p>&nbsp;</p>
            <p id='spinner-caption'> Downloading and initializing tulip.js ... </p>
          </div>

        </div>
      </div>
      <!-- content -->

      <!-- footer -->
      <!--<div data-role="footer" data-theme="d">
        <a href="http://www.tulip-software.org" data-role="dialog">www.tulip-software.org</a>
      </div>-->


      <!-- Left panel -->
      <div data-role="panel" id="computepanel" data-position="left" data-theme="a" data-display="overlay">

      <div data-role = "collapsible" data-theme = "a" data-mini="true" data-content-theme ="a" >
      <h3> Graph datasets </h3>
      <label><input id="load-in-worker" type="checkbox" name="checkbox-0" data-mini="true" checked=true> Load graphs in Web Worker (slower but with loading feeback) </label>

      <a data-role = "button" data-icon = "star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Programming Languages network" onclick ="loadGraphFromDataFolder('programming_language_network.tlp.gz')" > Programming Languages network </a>
      <a data-role = "button" data-icon = "star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="FIFA World Cup 2014 players network" onclick ="loadGraphFromDataFolder('world_cup_network.tlp.gz')" > FIFA World Cup 2014 players network </a>
      <a data-role = "button" data-icon = "star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Qt 5.4 Linux install" onclick ="loadGraphFromDataFolder('qt54_linux64_dist.tlp.gz')" > Qt 5.4 Linux install </a>
      <a data-role = "button" data-icon = "star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Graph with metanodes" onclick ="loadGraphFromDataFolder('metanodes.tlp.gz', 'groups')" > Graph with metaNodes </a>
      <a data-role = "button" data-icon = "star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Sample Tree" onclick ="loadGraphFromDataFolder('tree.tlp.gz')" > Sample Tree </a>
      <a data-role = "button" data-icon = "star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Debian Packages dependencies graph" onclick ="loadGraphFromDataFolder('debian_packages_dependencies.tlpb.gz')" > Debian Packages dependencies graph </a>
      <a data-role = "button" data-icon = "star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Npm Packages dependencies graph" onclick ="loadGraphFromDataFolder('npm_packages_dependencies.tlpb.gz')" > NPM Packages dependencies graph </a>
      <a data-role = "button" data-icon = "star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="PyPi Packages dependencies graph" onclick ="loadGraphFromDataFolder('pypi_packages_dependencies.tlpb.gz')" > PyPi Packages dependencies graph </a>
      <div data-role="controlgroup">
      <input type="file" id="graph_file"/>
      </div>
      </div>

      <div data-role = "collapsible" data-theme = "a" data-mini="true" data-content-theme ="a" >
      <h3> Force directed layouts </h3>
      <div data-role = "controlgroup" data-type = "vertical" >
      <a data-role = "button" class = "show-page-loading-msg" data-icon = "star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Computing 'Davidson Harel (OGDF)' graph layout" onclick ="computeLayout('Davidson Harel (OGDF)')" > Davidson Harel (OGDF) </a>
      <a data-role = "button" class = "show-page-loading-msg" data-icon = "star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Computing 'Fast Multipole Embedder (OGDF)' graph layout" onclick ="computeLayout('Fast Multipole Embedder (OGDF)')" > Fast Multipole Embedder (OGDF) </a>
      <a data-role = "button" class = "show-page-loading-msg" data-icon ="star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Computing 'FM^3 (OGDF)' graph layout" onclick ="computeLayout('FM^3 (OGDF)')" > FM^3 (OGDF) </a>
      <a data-role = "button" class = "show-page-loading-msg" data-icon ="star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Computing 'GEM (Frick)' graph layout" onclick ="computeLayout('GEM (Frick)')" > GEM (Frick) </a>
      <a data-role = "button" class = "show-page-loading-msg" data-icon ="star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Computing 'Frutcherman Reingold (OGDF)' graph layout" onclick ="computeLayout('Frutcherman Reingold (OGDF)')" > Frutcherman Reingold (OGDF) </a>
      <a data-role = "button" class = "show-page-loading-msg" data-icon ="star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Computing 'Kamada Kawai (OGDF)' graph layout" onclick ="computeLayout('Kamada Kawai (OGDF)')" > Kamada Kawai (OGDF) </a>
      </div>
      </div>

      <div data-role = "collapsible" data-theme = "a" data-mini="true" data-content-theme ="a" >
      <h3> Multilevel layouts </h3>
      <div data-role = "controlgroup" data-type = "vertical" >
      <a data-role = "button" class = "show-page-loading-msg" data-icon ="star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Computing 'GRIP' graph layout" onclick ="computeLayout('GRIP')" > GRIP </a>
      <a data-role = "button" class = "show-page-loading-msg" data-icon ="star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Computing 'Fast Multipole Multilevel Embedder (OGDF)' graph layout" onclick ="computeLayout('Fast Multipole Multilevel Embedder (OGDF)')" > Fast Multipole Multilevel Embedder (OGDF) </a>
      <a data-role = "button" class = "show-page-loading-msg" data-icon ="star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Computing 'MMM Example Fast Layout (OGDF)' graph layout" onclick ="computeLayout('MMM Example Fast Layout (OGDF)')" > MMM Example Fast Layout (OGDF) </a>
      <a data-role = "button" class = "show-page-loading-msg" data-icon ="star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Computing 'MMM Example Nice Layout (OGDF)' graph layout" onclick ="computeLayout('MMM Example Nice Layout (OGDF)')" > MMM Example Nice Layout (OGDF) </a>
      <a data-role = "button" class = "show-page-loading-msg" data-icon ="star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Computing 'MMM Example No Twist Layout (OGDF)' graph layout" onclick ="computeLayout('MMM Example No Twist Layout (OGDF)')" > MMM Example No Twist Layout (OGDF) </a>
      </div>
      </div>

      <div data-role = "collapsible" data-theme = "a" data-mini="true" data-content-theme ="a" >
      <h3> Tree layouts </h3>
      <div data-role = "controlgroup" data-type = "vertical" >
      <a data-role = "button" class = "show-page-loading-msg" data-icon ="star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Computing 'Bubble Tree' graph layout" onclick ="computeLayout('Bubble Tree')" > Bubble Tree </a>
      <a data-role = "button" class = "show-page-loading-msg" data-icon ="star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Computing 'Cone Tree' graph layout" onclick ="computeLayout('Cone Tree')" > Cone Tree </a>
      <a data-role = "button" class = "show-page-loading-msg" data-icon ="star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Computing 'Hierarchical Tree (R-T Extended)' graph layout" onclick ="computeLayout('Hierarchical Tree (R-T Extended)')" > Hierarchical Tree (R-T Extended) </a>
      <a data-role = "button" class = "show-page-loading-msg" data-icon ="star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Computing 'Tree Radial' graph layout" onclick ="computeLayout('Tree Radial')" > Tree Radial </a>
      <a data-role = "button" class = "show-page-loading-msg" data-icon ="star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Computing 'Sugiyama (OGDF)' graph layout" onclick ="computeLayout('Sugiyama (OGDF)')" > Sugiyama (OGDF) </a>
      </div>
      </div>

      <div data-role = "collapsible" data-theme = "a" data-mini="true" data-content-theme ="a" >
      <h3> Miscellaneous algorithms </h3>
      <div data-role = "controlgroup" data-type = "vertical" >
      <a data-role = "button" class = "show-page-loading-msg" data-icon ="star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Applying 'Auto-Sizing' algorithm" onclick ="computeAutoSizing()" > Auto-Sizing </a>
      <a data-role = "button" class = "show-page-loading-msg" data-icon ="star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="Applying 'Edge bundling' algorithm" onclick ="computeEdgeBundling()" > Edge bundling </a>
      <a data-role = "button" class = "show-page-loading-msg" data-icon ="star" data-mini = "true" data-textonly="false" data-textvisible="true" data-msgtext="" onclick ="applyGraphScript()" > Magic script </a>
      </div>
      </div>

      <a data-role = "button" data-icon = "star" data-mini = "true" onclick ="graph.downloadTlpFile();">Save graph to TLP format</a>
      <a data-role = "button" data-icon = "refresh" data-mini = "true" onclick ="tulipView.centerScene();">Center</a>
      <a data-role="button" data-icon="grid" data-mini = "true" onclick="tulipView.fullScreen();">Fullscreen</a>
      <a data-role = "button" data-icon = "close" data-mini = "true" data-rel="close">Close panel</a>

      </div><!-- /panel left-->

      <!-- /panel right-->
      <div data-role="panel" id="renderingparamspanel" data-position="right" data-theme="a" data-display="overlay">
      <div data-role = "collapsible" data-theme = "a" data-mini="true" data-content-theme ="a" >
      <h3> Nodes </h3>
      <label><input id="display-nodes" type="checkbox" data-mini="true" checked=true> Display </label>
      </div>
      <div data-role = "collapsible" data-theme = "a" data-mini="true" data-content-theme ="a" >
      <h3> Edges </h3>
      <label><input id="display-edges" type="checkbox" data-mini="true" checked=true> Display </label>
      <label><input id="color-interpolation" type="checkbox" data-mini="true" checked=false> Color interpolation </label>
      <label><input id="size-interpolation" type="checkbox" data-mini="true" checked=true> Size interpolation </label>
      <label><input id="edge-extremities" type="checkbox" data-mini="true" checked=true>  Display extremities </label>
      </div>
      </div>

    </div> <!-- /page one -->



</body>
<script type='text/javascript'>

 var tulipView = null;

 function activateInteractor(interactorName) {
   return function() {
     $('.interactor-button').removeClass('ui-btn-active');
     $(this).addClass('ui-btn-active');
     tulipView.activateInteractor(interactorName);
     tulipView.draw();
   }
 }

 $('#navigation-button').button().bind('click', activateInteractor('ZoomAndPan'));

 $('#zoom-button').button().bind('click', activateInteractor('RectangleZoom'));

 $('#selection-button').button().bind('click', activateInteractor('Selection'));

 $('#selection-modifier-button').button().bind('click', activateInteractor('SelectionModifier'));

 $('#lasso-selection-button').button().bind('click', activateInteractor('LassoSelection'));

 $('#neighborhood-highlighter-button').button().bind('click', activateInteractor('Neighborhood'));

 $("#color-interpolation, #size-interpolation, \
   #edge-extremities, #display-edges, #display-nodes").change(function(){
   applyRenderingParameters();
 });

 var start = null;
 var graph = null;
 var subgraph = null;

 function applyRenderingParameters() {
   tulip.holdObservers();
   renderingParameters.setDisplayNodes($('#display-nodes').prop('checked'));
   renderingParameters.setDisplayEdges($('#display-edges').prop('checked'));
   renderingParameters.setInterpolateEdgesColors($('#color-interpolation').prop('checked'));
   renderingParameters.setInterpolateEdgesSizes($('#size-interpolation').prop('checked'));
   renderingParameters.setDisplayEdgesExtremities($('#edge-extremities').prop('checked'));
   tulip.unholdObservers();
 }

 function setGlobalVars(g) {
   console.log(g.getAttribute("file"));
   var end = new Date().getTime();
   var time = (end - start) / 1000;
   console.log('Time for loading graph: ' + time + 's');
   graph = g;
   viewLayout = graph.getLayoutProperty('viewLayout');
   viewSelection = graph.getBooleanProperty("viewSelection");
   viewRotation = graph.getDoubleProperty("viewRotation");
   viewShape = graph.getIntegerProperty("viewShape");
   viewFontAwesomeIcon = graph.getStringProperty("viewFontAwesomeIcon");
   viewColor = graph.getColorProperty("viewColor");
   viewBorderWidth = graph.getDoubleProperty("viewBorderWidth")
   viewBorderColor = graph.getColorProperty("viewBorderColor")
   viewSize = graph.getSizeProperty("viewSize")
   viewMetric = graph.getDoubleProperty("viewMetric")
   viewSrcAnchorShape = graph.getIntegerProperty("viewSrcAnchorShape")
   viewTgtAnchorShape = graph.getIntegerProperty("viewTgtAnchorShape")
   viewTexture = graph.getStringProperty("viewTexture")
 }

 function computeEdgeBundling() {
   viewShape.setAllEdgeValue(tulip.EdgeShape.BezierCurve);
   graph.applyAlgorithmInWorker('Edge bundling');
 }

 function computeLayout(layoutAlgoName) {
   graph.applyLayoutAlgorithmInWorker(layoutAlgoName, viewLayout);
 }

 function computeAutoSizing() {
   graph.applySizeAlgorithmInWorker('Auto Sizing', viewSize);
 }

 function graphScript(graph) {
    var viewLayout = graph.getLayoutProperty('viewLayout');
    var viewSize = graph.getSizeProperty('viewSize');
    var viewShape = graph.getIntegerProperty('viewShape');
    viewShape.setAllEdgeValue(tulip.EdgeShape.BezierCurve);
    graph.applyLayoutAlgorithm('FM^3 (OGDF)', viewLayout);
    graph.applySizeAlgorithm('Auto Sizing', viewSize);
    graph.applyLayoutAlgorithm('Fast Overlap Removal', viewLayout);
    graph.applyAlgorithm('Edge bundling', {}, true);
 }

 function applyGraphScript() {
   graph.executeScriptInWorker(graphScript);
 }

 function graphScriptEndedCallback(succeed, graph) {
   console.log(succeed);
 }

 function genRandomColor() {
   var r = (Math.random() * 256) | 0;
   var g = (Math.random() * 256) | 0;
   var b = (Math.random() * 256) | 0;
   return tulip.Color(r, g, b);
 }

 function computeGraphStats() {
   var sum = 0;
   graph.getNodes().forEach(function(node) {
     sum += graph.deg(node);
   });

   var avgEdgeLength = 0;
   graph.getEdges().forEach(function(edge) {
    var srcCoord = viewLayout.getNodeValue(graph.source(edge));
    var tgtCoord = viewLayout.getNodeValue(graph.target(edge));
    var bends = viewLayout.getEdgeValue(edge);
    if (bends.length == 0) {
      avgEdgeLength += srcCoord.dist(tgtCoord);
    } else {
      avgEdgeLength += srcCoord.dist(bends[0]);
      for (var i = 1 ; i < bends.length ; ++i) {
        avgEdgeLength += bends[i-1].dist(bends[i]);
      }
      avgEdgeLength += bends[bends.length-1].dist(tgtCoord);
    }
   });
   console.log("average node degree = ", sum / graph.numberOfNodes());
   console.log("average edge length = ", avgEdgeLength / graph.numberOfEdges());
 }

 function setRandomGlyphsAndColors() {
   var iconNames = [];
   for (var key in tulip.FontAwesomeIcon) {
      if (tulip.FontAwesomeIcon.hasOwnProperty(key)) {
          iconNames.push(tulip.FontAwesomeIcon[key]);
      }
   }

   viewRotation.setAllNodeValue(0);

   viewShape.setAllNodeValue(tulip.NodeShape.FontAwesomeIcon);
   graph.getNodes().forEach(function(n) {
       var idx = (Math.random() * iconNames.length) | 0;
       viewFontAwesomeIcon.setNodeValue(n, iconNames[idx]);
       viewColor.setNodeValue(n, genRandomColor());
   });
 }

 function handleFileSelect(evt) {
    var files = evt.target.files;
    if (files[0]) {
        var reader = new FileReader();
        // Closure to capture the file information.
        reader.onload = (function(theFile) {
            return function(e) {
              start = new Date().getTime();
              tulipView.loadGraphFromData(theFile.name, e.target.result, $('#load-in-worker').prop('checked'), setGlobalVars);
            };
        })(files[0]);
        reader.readAsArrayBuffer(files[0]);
    }
 }

 document.getElementById('graph_file').addEventListener('change', handleFileSelect, false);

 function tulipGraphEventHandler(event) {
   console.log("Received event : ", event.eventType, " for graph ", event.graph.getName());
 }

 function tulipPropertyEventHandler(event) {
   console.log("Received event : ", event.eventType, " for graph property ", event.property.getName());
 }

 function getMousePos(canvas, evt) {
   var rect = canvas.getBoundingClientRect();
   return {
     x: (evt.clientX - rect.left) | 0,
     y: (evt.clientY - rect.top) | 0,
   };
 }

 function setSubGraphToVisualize(sgName) {
   return function(graph) {
     var sg = graph.getDescendantGraph(sgName);
     setGlobalVars(sg);
     tulipView.setGraph(sg);
   }
 }

 function loadGraphFromDataFolder(tlpFilename, sgToVisualize) {
   start = new Date().getTime();
   if (sgToVisualize) {
     tulipView.loadGraphFromFile("data/" + tlpFilename, $('#load-in-worker').prop('checked'), setSubGraphToVisualize(sgToVisualize));
   } else {
     tulipView.loadGraphFromFile("data/" + tlpFilename, $('#load-in-worker').prop('checked'), setGlobalVars);
   }
 }

 function initTulipView() {
   if (typeof tulip == 'undefined' || !tulip.isLoaded()) {
     setTimeout(initTulipView, 1000);
   } else {
     $('#spinner-div').hide();
     $('#tulip-view').css('vertical-align', 'baseline');
     tulip.addListener("GraphEvent", tulipGraphEventHandler);
     tulip.addListener("PropertyEvent", tulipPropertyEventHandler);
     var container = document.getElementById("tulip-view");
     tulipView = tulip.View(container, window.innerWidth-50, window.innerHeight-80);
     renderingParameters = tulipView.getRenderingParameters();
     applyRenderingParameters();
     loadGraphFromDataFolder("programming_language_network.tlp.gz");
   }
 }

function resize() {
  if (tulipView && tulipView.fullScreenActivated) return;
  if (tulipView) {
    tulipView.resize(window.innerWidth-50, window.innerHeight-80);
  }
}

var importScript = (function (oHead) {

  return function (sSrc, fOnload) {
    var oScript = document.createElement("script");
    oScript.type = "text\/javascript";
    if (fOnload) { oScript.onload = fOnload; }
    oHead.appendChild(oScript);
    oScript.src = sSrc;
  }

})(document.head || document.getElementsByTagName("head")[0]);

$( document ).ready(function() {
  $('#tulip-view').width(window.innerWidth-50);
  $('#tulip-view').height(window.innerHeight-80);
  window.addEventListener('resize', resize, false);

  importScript("tulip.js",
    function() {
      initTulipView()
    }
  );

});

</script>

</html>
