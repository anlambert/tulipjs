<!DOCTYPE HTML>
<html>
    <head>
    <title>Tulip Webix</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="http://cdn.webix.com/edge/webix.css" type="text/css">
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <script src="http://cdn.webix.com/edge/webix.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js" type="text/javascript"></script>
    <script async type="text/javascript" src="tulip.js"></script>
    </head>
    <body>
        <div id="tulip-view" class='tulip-view-class' style='width:100%; height:100%;'></div>
        <script type="text/javascript" charset="utf-8">

        tulipView = null;

        var tulipWebUi = new webix.ui({
          id: "app",
          view: "tabview",
          cells: [
            {
              header: "Node-link view",
              body: {
                cols:[
                  { view:"toolbar",
                    width: 300,
                    rows:[
                      { template: "<input type='file' id='graph_file'/>", height: 35},
                      { multi: true,
                        view:"accordion",
                        rows:[
                          { collapsed: true,
                            header:"Force directed layouts",
                            body: { view:"toolbar",
                                    rows:[
                                      { view:"button", type:"icon", icon:"star", label:"Davidson Harel (OGDF)", click: function() {computeLayout(this.config.label)}},
                                      { view:"button", type:"icon", icon:"star", label:"Fast Multipole Embedder (OGDF)", click: function() {computeLayout(this.config.label)}},
                                      { view:"button", type:"icon", icon:"star", label:"FM^3 (OGDF)", click: function() {computeLayout(this.config.label)}},
                                      { view:"button", type:"icon", icon:"star", label:"GEM (Frick)", click: function() {computeLayout(this.config.label)}},
                                      { view:"button", type:"icon", icon:"star", label:"Fruchterman Reingold (OGDF)", click: function() {computeLayout(this.config.label)}},
                                      { view:"button", type:"icon", icon:"star", label:"kamada Kawai (OGDF)", click: function() {computeLayout(this.config.label)}}
                                    ]
                                  }
                          }
                        ]
                      },
                      { multi: true,
                        view:"accordion",
                        rows:[
                          { collapsed: true,
                            header:"Multilevel layouts",
                            body: { view:"toolbar",
                                    rows:[
                                      { view:"button", type:"icon", icon:"star", label:"GRIP", click: function() {computeLayout(this.config.label)}},
                                      { view:"button", type:"icon", icon:"star", label:"Fast Multipole Multilevel Embedder (OGDF)", click: function() {computeLayout(this.config.label)}},
                                      { view:"button", type:"icon", icon:"star", label:"MMM Example Fast Layout (OGDF)", click: function() {computeLayout(this.config.label)}},
                                      { view:"button", type:"icon", icon:"star", label:"MMM Example Nice Layout (OGDF)", click: function() {computeLayout(this.config.label)}},
                                      { view:"button", type:"icon", icon:"star", label:"MMM Example No Twist Layout (OGDF)", click: function() {computeLayout(this.config.label)}}
                                    ]
                                  }
                          }
                        ]
                      },
                      { multi: true,
                        view:"accordion",
                        rows:[
                          { collapsed: true,
                            header:"Tree layouts",
                            body: { view:"toolbar",
                                    rows:[
                                      { view:"button", type:"icon", icon:"star", label:"Bubble Tree", click: function() {computeLayout(this.config.label)}},
                                      { view:"button", type:"icon", icon:"star", label:"Cone Tree", click: function() {computeLayout(this.config.label)}},
                                      { view:"button", type:"icon", icon:"star", label:"Hierarchical Tree (R-T Extended)", click: function() {computeLayout(this.config.label)}},
                                      { view:"button", type:"icon", icon:"star", label:"Tree Radial", click: function() {computeLayout(this.config.label)}},
                                      { view:"button", type:"icon", icon:"star", label:"Sugiyama (OGDF)", click: function() {computeLayout(this.config.label)}}
                                    ]
                                  }
                          }
                        ]
                      },
                      { gravity: 1}
                    ]
                  },
                  { view:"resizer"},
                  { id: "graph-view-ui",
                    rows: [
                    { id: "interactor-toolbar",
                      view:"toolbar",
                      cols:[
                        { id:"navigate-button", view:"toggle", type:"iconButton", label:"Navigate", icon:"hand-o-up", tooltip:"Navigate in graph", click: interactorButtonClicked},
                        { id:"zoom-button", view:"toggle", type:"iconButton", label:"Zoom", icon:"search", tooltip:"Zoom on rectangle", click: interactorButtonClicked},
                        { id:"selection-button", view:"toggle", type:"iconButton", label:"Selection", icon:"square-o", tooltip:"Select nodes/edges in a rectangle", click: interactorButtonClicked},
                        { id:"lasso-selection-button", view:"toggle", type:"iconButton", label:"Lasso selection", icon:"pencil-square-o", tooltip:"Select nodes and induced-subgraph in a freehand drawn region", click: interactorButtonClicked},
                        { id:"node-neighborhood-button", view:"toggle", type:"iconButton", label:"Neighborhood", icon:"share-alt", tooltip:"Highlight node neighborhood", click: interactorButtonClicked},
                        { id:"selection-modifier-button", view:"toggle", type:"iconButton", label:"Selection modifier", icon:"arrows", tooltip:"Move rectangle selection", click: interactorButtonClicked}
                      ]
                    },
                    { id:"graph-view", content:"tulip-view"}
                   ]
                  }
                ]
              }
            },
            {
              header:"Table view",
              body: {
                view:"datatable"
              }
            }
          ]
        });

        function interactorButtonClicked(id) {
          var toolbarChilds = $$("interactor-toolbar").getChildViews();
          for (var i = 0 ; i < toolbarChilds.length ; ++i) {
            toolbarChilds[i].setValue(false);
          }
          if (id == "navigate-button") {
            tulipView.activateNavigationInteractor();
          } else if (id == "zoom-button") {
            tulipView.activateZoomInteractor();
          } else if (id == "selection-button") {
            tulipView.activateSelectionInteractor();
          } else if (id == "lasso-selection-button") {
            tulipView.activateLassoSelectionInteractor();
          } else if (id == "node-neighborhood-button") {
            tulipView.activateNeighborhoodInteractor();
          } else if (id == "selection-modifier-button") {
            tulipView.activateSelectionModifierInteractor();
          }
          return true;
        }

        $$("navigate-button").toggle();

        $$("graph-view-ui").attachEvent("onViewResize", function(id) {
          resizeGraphView();
        });

        //adding ProgressBar functionality to layout
        webix.extend($$("graph-view"), webix.ProgressBar);

        $$("app").disable();
        $$("graph-view").showProgress({
            type:"icon",
            delay:0
        });

        function resizeGraphView() {
          if (tulipView && tulipView.fullScreenActivated) return;
          if (tulipView) {
            tulipView.resize($$("graph-view").$width, $$("graph-view").$height);
          }
        }

        window.addEventListener('resize', resizeGraphView, false);

        function setGlobalVars(g) {
         graph = g;
         viewLayout = graph.getLayoutProperty('viewLayout');
         viewSelection = graph.getBooleanProperty("viewSelection");
         viewRotation = graph.getDoubleProperty("viewRotation");
         viewShape = graph.getIntegerProperty("viewShape");
         viewFontAwesomeIcon = graph.getStringProperty("viewFontAwesomeIcon");
         viewColor = graph.getColorProperty("viewColor");
         viewBorderWidth = graph.getDoubleProperty("viewBorderWidth")
         viewBorderColor = graph.getColorProperty("viewBorderColor")
         viewSize = graph.getSizeProperty("viewSize")
         viewMetric = graph.getDoubleProperty("viewMetric")
         viewSrcAnchorShape = graph.getIntegerProperty("viewSrcAnchorShape")
         viewTgtAnchorShape = graph.getIntegerProperty("viewTgtAnchorShape")
         viewTexture = graph.getStringProperty("viewTexture")
         $$("app").enable();
        }

        function initTulipView() {
         if (typeof tulip == 'undefined' || !tulip.isLoaded()) {
           setTimeout(initTulipView, 1000);
         } else {
           $$("graph-view").hideProgress();
           var container = document.getElementById("tulip-view");
           tulipView = tulip.View(container);
           tulipView.loadGraphFromFile("data/little_grid.tlp.gz", true, setGlobalVars);
         }
        }

        function computeLayout(layoutAlgoName) {
          graph.applyLayoutAlgorithmInWorker(layoutAlgoName, viewLayout);
        }

        initTulipView();

        function handleFileSelect(evt) {
          var files = evt.target.files;
          if (files[0]) {
              var reader = new FileReader();
              // Closure to capture the file information.
              reader.onload = (function(theFile) {
                  return function(e) {
                    tulipView.loadGraphFromData(theFile.name, e.target.result, true, setGlobalVars);
                  };
              })(files[0]);
              reader.readAsArrayBuffer(files[0]);
          }
        }

        document.getElementById('graph_file').addEventListener('change', handleFileSelect, false);

        </script>
    </body>
</html>
